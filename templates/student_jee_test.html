<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ test.subject }} - {{ test.test_id }} - Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        .question-nav-btn { width: 40px; height: 40px; margin: 2px; }
        .not-visited { background: #e0e0e0; }
        .answered { background: #28a745; color: #fff; }
        .review { background: #6f42c1; color: #fff; }
        .current { border: 2px solid #007bff; }
    </style>
</head>
<body class="bg-light">
<nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">Eso Kichu Kori</a>
    <span class="navbar-text ms-3">MOCK TEST</span>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="/student/tests">Back to Tests</a></li>
        <li class="nav-item"><a class="nav-link" href="/logout">Logout</a></li>
      </ul>
    </div>
  </div>
</nav>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-8">
            <div class="card shadow-sm mb-3">
                <div class="card-body">
                    <h5>Question {{ q_idx+1 }} of {{ len(questions) }}</h5>
                    <hr>
                    <div class="mb-3">
                        <div class="mb-2"><strong>Q{{ q_idx+1 }}. <span class="mathjax">{{ questions[q_idx]['QuestionText']|safe }}</span></strong></div>
                        {% if questions[q_idx]['ImageFile'] %}
                        <img src="/static/{{ questions[q_idx]['ImageFile'] }}" alt="Question Image" class="img-fluid mb-2">
                        {% endif %}
                        {% if questions[q_idx]['EquationLaTeX'] %}
                        <div class="mathjax">\[{{ questions[q_idx]['EquationLaTeX'] }}\]</div>
                        {% endif %}
                    </div>
                    <form method="post">
                        <input type="hidden" name="q_idx" value="{{ q_idx }}">
                        <div class="mb-2">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="selected" value="A" id="optA" {% if state['answers'][q_idx]=='A' %}checked{% endif %}>
                                <label class="form-check-label" for="optA">A. {{ questions[q_idx]['OptionA'] }}</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="selected" value="B" id="optB" {% if state['answers'][q_idx]=='B' %}checked{% endif %}>
                                <label class="form-check-label" for="optB">B. {{ questions[q_idx]['OptionB'] }}</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="selected" value="C" id="optC" {% if state['answers'][q_idx]=='C' %}checked{% endif %}>
                                <label class="form-check-label" for="optC">C. {{ questions[q_idx]['OptionC'] }}</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="selected" value="D" id="optD" {% if state['answers'][q_idx]=='D' %}checked{% endif %}>
                                <label class="form-check-label" for="optD">D. {{ questions[q_idx]['OptionD'] }}</label>
                            </div>
                        </div>
                        <div class="mt-3">
                            <button name="action" value="save_next" class="btn btn-success">Save & Next</button>
                            <button name="action" value="mark_review" class="btn btn-warning">Mark for Review</button>
                            <button name="action" value="clear" class="btn btn-secondary">Clear</button>
                            <button name="action" value="submit" class="btn btn-danger float-end">Submit</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm mb-3">
                <div class="card-body">
                    <h5>Question Navigation</h5>
                    <div class="mb-2">
                        {% for i, _ in enumerate(questions) %}
                        <form method="post" style="display:inline-block;">
                            <input type="hidden" name="q_idx" value="{{ q_idx }}">
                            <input type="hidden" name="goto_idx" value="{{ i }}">
                            <button name="action" value="goto" type="submit" class="btn question-nav-btn
                                {% if i == q_idx %}current{% elif state['review'][i] %}review{% elif state['answers'][i] %}answered{% elif state['visited'][i] %}not-visited{% else %}not-visited{% endif %}">
                                {{ i+1 }}
                            </button>
                        </form>
                        {% endfor %}
                    </div>
                    <div class="mb-2">
                        <span class="badge bg-secondary">Not Visited</span>
                        <span class="badge bg-success">Answered</span>
                        <span class="badge bg-warning text-dark">Marked for Review</span>
                        <span class="badge bg-primary">Current</span>
                    </div>
                    <div class="mt-3">
                        <strong>Timer:</strong> <span id="timer">--:--:--</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
// MathJax typeset
window.addEventListener('DOMContentLoaded', function() {
    if (window.MathJax) MathJax.typeset();
});
// Simple timer (for demo)
let start = Date.now();
function updateTimer() {
    let now = Date.now();
    let diff = Math.floor((now - start) / 1000);
    let h = Math.floor(diff / 3600);
    let m = Math.floor((diff % 3600) / 60);
    let s = diff % 60;
    document.getElementById('timer').textContent = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
}
setInterval(updateTimer, 1000);
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html> 